    .BYTE test $00

.FUNCTION mul8
    .BYTE mul8_return 0
    .BYTE mul8_a 0
    .BYTE mul8_b 0
    .LOCALS
    .BYTE mul8_res 0
    .BYTE mul8_flag 0
    .TMP
    .BYTE mul8_0 0
    .CODE
    MOV mul8_flag,#$01
    MOV mul8_res,#$00
    .LABEL mul8_vm_0
    JZ mul8_vm_1,mul8_flag
    AND mul8_0,mul8_flag,mul8_b
    JZ mul8_vm_3,mul8_0
    ADD mul8_0,mul8_res,mul8_a
    MOV mul8_res,mul8_0
    .LABEL mul8_vm_3
    SHL mul8_0,mul8_a,#$01
    MOV mul8_a,mul8_0
    SHL mul8_0,mul8_flag,#$01
    MOV mul8_flag,mul8_0
    JMP mul8_vm_0
    .LABEL mul8_vm_1
    MOV mul8_return,mul8_res
    JMP mul8_end
    .LABEL mul8_end
.RETURN mul8

.FUNCTION mul16
    .BYTE mul16_return_H 0
    .BYTE mul16_return_L 0
    .BYTE mul16_a_H 0
    .BYTE mul16_a_L 0
    .BYTE mul16_b_H 0
    .BYTE mul16_b_L 0
    .LOCALS
    .BYTE mul16_res_H 0
    .BYTE mul16_res_L 0
    .BYTE mul16_flag_H 0
    .BYTE mul16_flag_L 0
    .TMP
    .BYTE mul16_0 0
    .BYTE mul16_1 0
    .CODE
    CAST mul16_flag_H:mul16_flag_L,#$01
    CAST mul16_res_H:mul16_res_L,#$00
    .LABEL mul16_vm_0
    JZ mul16_vm_1,mul16_flag_H:mul16_flag_L
    AND mul16_0:mul16_1,mul16_flag_H:mul16_flag_L,mul16_b_H:mul16_b_L
    JZ mul16_vm_3,mul16_0:mul16_1
    ADD mul16_0:mul16_1,mul16_res_H:mul16_res_L,mul16_a_H:mul16_a_L
    MOV mul16_res_H:mul16_res_L,mul16_0:mul16_1
    .LABEL mul16_vm_3
    SHL mul16_0:mul16_1,mul16_a_H:mul16_a_L,#$01
    MOV mul16_a_H:mul16_a_L,mul16_0:mul16_1
    SHL mul16_0:mul16_1,mul16_flag_H:mul16_flag_L,#$01
    MOV mul16_flag_H:mul16_flag_L,mul16_0:mul16_1
    JMP mul16_vm_0
    .LABEL mul16_vm_1
    MOV mul16_return_H:mul16_return_L,mul16_res_H:mul16_res_L
    JMP mul16_end
    .LABEL mul16_end
.RETURN mul16

.FUNCTION div8
    .BYTE div8_return 0
    .BYTE div8_a 0
    .BYTE div8_b 0
    .LOCALS
    .BYTE div8_q 0
    .BYTE div8_r 0
    .BYTE div8_flag 0
    .BYTE div8_sign 0
    .TMP
    .BYTE div8_0 0
    .CODE
    MOV div8_q,#$00
    MOV div8_r,#$00
    MOV div8_sign,#$00
    LT div8_0,div8_a,#$00
    JZ div8_vm_1,div8_0
    NEG div8_0,div8_a
    MOV div8_a,div8_0
    MOV div8_sign,#$01
    .LABEL div8_vm_1
    LT div8_0,div8_b,#$00
    JZ div8_vm_3,div8_0
    NEG div8_0,div8_b
    MOV div8_b,div8_0
    XOR div8_0,div8_sign,#$01
    MOV div8_sign,div8_0
    .LABEL div8_vm_3
    MOV div8_flag,#$80
    .LABEL div8_vm_4
    JZ div8_vm_5,div8_flag
    SHL div8_0,div8_r,#$01
    MOV div8_r,div8_0
    AND div8_0,div8_flag,div8_a
    JZ div8_vm_7,div8_0
    OR div8_0,div8_r,#$01
    MOV div8_r,div8_0
    .LABEL div8_vm_7
    GTE div8_0,div8_r,div8_b
    JZ div8_vm_9,div8_0
    SUB div8_0,div8_r,div8_b
    MOV div8_r,div8_0
    OR div8_0,div8_q,div8_flag
    MOV div8_q,div8_0
    .LABEL div8_vm_9
    SHR div8_0,div8_flag,#$01
    MOV div8_flag,div8_0
    JMP div8_vm_4
    .LABEL div8_vm_5
    JZ div8_vm_10,div8_sign
    NEG div8_0,div8_q
    JMP div8_vm_11
    .LABEL div8_vm_10
    MOV div8_0,div8_q
    .LABEL div8_vm_11
    MOV div8_return,div8_0
    JMP div8_end
    .LABEL div8_end
.RETURN div8

.FUNCTION div16
    .BYTE div16_return_H 0
    .BYTE div16_return_L 0
    .BYTE div16_a_H 0
    .BYTE div16_a_L 0
    .BYTE div16_b_H 0
    .BYTE div16_b_L 0
    .LOCALS
    .BYTE div16_q_H 0
    .BYTE div16_q_L 0
    .BYTE div16_r_H 0
    .BYTE div16_r_L 0
    .BYTE div16_flag_H 0
    .BYTE div16_flag_L 0
    .BYTE div16_sign 0
    .TMP
    .BYTE div16_0 0
    .BYTE div16_1 0
    .CODE
    CAST div16_q_H:div16_q_L,#$00
    CAST div16_r_H:div16_r_L,#$00
    MOV div16_sign,#$00
    CAST div16_0:div16_1,#$00
    LT div16_1,div16_a_H:div16_a_L,div16_0:div16_1
    JZ div16_vm_1,div16_1
    NEG div16_0:div16_1,div16_a_H:div16_a_L
    MOV div16_a_H:div16_a_L,div16_0:div16_1
    MOV div16_sign,#$01
    .LABEL div16_vm_1
    CAST div16_0:div16_1,#$00
    LT div16_1,div16_b_H:div16_b_L,div16_0:div16_1
    JZ div16_vm_3,div16_1
    NEG div16_0:div16_1,div16_b_H:div16_b_L
    MOV div16_b_H:div16_b_L,div16_0:div16_1
    XOR div16_1,div16_sign,#$01
    MOV div16_sign,div16_1
    .LABEL div16_vm_3
    MOV div16_flag_H:div16_flag_L,#$80:#$00
    .LABEL div16_vm_4
    JZ div16_vm_5,div16_flag_H:div16_flag_L
    SHL div16_0:div16_1,div16_r_H:div16_r_L,#$01
    MOV div16_r_H:div16_r_L,div16_0:div16_1
    AND div16_0:div16_1,div16_flag_H:div16_flag_L,div16_a_H:div16_a_L
    JZ div16_vm_7,div16_0:div16_1
    CAST div16_0:div16_1,#$01
    OR div16_0:div16_1,div16_r_H:div16_r_L,div16_0:div16_1
    MOV div16_r_H:div16_r_L,div16_0:div16_1
    .LABEL div16_vm_7
    GTE div16_1,div16_r_H:div16_r_L,div16_b_H:div16_b_L
    JZ div16_vm_9,div16_1
    SUB div16_0:div16_1,div16_r_H:div16_r_L,div16_b_H:div16_b_L
    MOV div16_r_H:div16_r_L,div16_0:div16_1
    OR div16_0:div16_1,div16_q_H:div16_q_L,div16_flag_H:div16_flag_L
    MOV div16_q_H:div16_q_L,div16_0:div16_1
    .LABEL div16_vm_9
    SHR div16_0:div16_1,div16_flag_H:div16_flag_L,#$01
    MOV div16_flag_H:div16_flag_L,div16_0:div16_1
    JMP div16_vm_4
    .LABEL div16_vm_5
    JZ div16_vm_10,div16_sign
    NEG div16_0:div16_1,div16_q_H:div16_q_L
    JMP div16_vm_11
    .LABEL div16_vm_10
    MOV div16_0:div16_1,div16_q_H:div16_q_L
    .LABEL div16_vm_11
    MOV div16_return_H:div16_return_L,div16_0:div16_1
    JMP div16_end
    .LABEL div16_end
.RETURN div16

.FUNCTION mod8
    .BYTE mod8_return 0
    .BYTE mod8_a 0
    .BYTE mod8_b 0
    .LOCALS
    .BYTE mod8_q 0
    .BYTE mod8_r 0
    .BYTE mod8_flag 0
    .BYTE mod8_sign 0
    .TMP
    .BYTE mod8_0 0
    .CODE
    MOV mod8_q,#$00
    MOV mod8_r,#$00
    MOV mod8_sign,#$00
    LT mod8_0,mod8_a,#$00
    JZ mod8_vm_1,mod8_0
    NEG mod8_0,mod8_a
    MOV mod8_a,mod8_0
    MOV mod8_sign,#$01
    .LABEL mod8_vm_1
    LT mod8_0,mod8_b,#$00
    JZ mod8_vm_3,mod8_0
    NEG mod8_0,mod8_b
    MOV mod8_b,mod8_0
    .LABEL mod8_vm_3
    MOV mod8_flag,#$80
    .LABEL mod8_vm_4
    JZ mod8_vm_5,mod8_flag
    SHL mod8_0,mod8_r,#$01
    MOV mod8_r,mod8_0
    AND mod8_0,mod8_flag,mod8_a
    JZ mod8_vm_7,mod8_0
    OR mod8_0,mod8_r,#$01
    MOV mod8_r,mod8_0
    .LABEL mod8_vm_7
    GTE mod8_0,mod8_r,mod8_b
    JZ mod8_vm_9,mod8_0
    SUB mod8_0,mod8_r,mod8_b
    MOV mod8_r,mod8_0
    OR mod8_0,mod8_q,mod8_flag
    MOV mod8_q,mod8_0
    .LABEL mod8_vm_9
    SHR mod8_0,mod8_flag,#$01
    MOV mod8_flag,mod8_0
    JMP mod8_vm_4
    .LABEL mod8_vm_5
    JZ mod8_vm_10,mod8_sign
    NEG mod8_0,mod8_r
    JMP mod8_vm_11
    .LABEL mod8_vm_10
    MOV mod8_0,mod8_r
    .LABEL mod8_vm_11
    MOV mod8_return,mod8_0
    JMP mod8_end
    .LABEL mod8_end
.RETURN mod8

.FUNCTION mod16
    .BYTE mod16_return_H 0
    .BYTE mod16_return_L 0
    .BYTE mod16_a_H 0
    .BYTE mod16_a_L 0
    .BYTE mod16_b_H 0
    .BYTE mod16_b_L 0
    .LOCALS
    .BYTE mod16_q_H 0
    .BYTE mod16_q_L 0
    .BYTE mod16_r_H 0
    .BYTE mod16_r_L 0
    .BYTE mod16_flag_H 0
    .BYTE mod16_flag_L 0
    .BYTE mod16_sign 0
    .TMP
    .BYTE mod16_0 0
    .BYTE mod16_1 0
    .CODE
    CAST mod16_q_H:mod16_q_L,#$00
    CAST mod16_r_H:mod16_r_L,#$00
    MOV mod16_sign,#$00
    CAST mod16_0:mod16_1,#$00
    LT mod16_1,mod16_a_H:mod16_a_L,mod16_0:mod16_1
    JZ mod16_vm_1,mod16_1
    NEG mod16_0:mod16_1,mod16_a_H:mod16_a_L
    MOV mod16_a_H:mod16_a_L,mod16_0:mod16_1
    MOV mod16_sign,#$01
    .LABEL mod16_vm_1
    CAST mod16_0:mod16_1,#$00
    LT mod16_1,mod16_b_H:mod16_b_L,mod16_0:mod16_1
    JZ mod16_vm_3,mod16_1
    NEG mod16_0:mod16_1,mod16_b_H:mod16_b_L
    MOV mod16_b_H:mod16_b_L,mod16_0:mod16_1
    .LABEL mod16_vm_3
    CAST mod16_flag_H:mod16_flag_L,#$80
    .LABEL mod16_vm_4
    JZ mod16_vm_5,mod16_flag_H:mod16_flag_L
    SHL mod16_0:mod16_1,mod16_r_H:mod16_r_L,#$01
    MOV mod16_r_H:mod16_r_L,mod16_0:mod16_1
    AND mod16_0:mod16_1,mod16_flag_H:mod16_flag_L,mod16_a_H:mod16_a_L
    JZ mod16_vm_7,mod16_0:mod16_1
    CAST mod16_0:mod16_1,#$01
    OR mod16_0:mod16_1,mod16_r_H:mod16_r_L,mod16_0:mod16_1
    MOV mod16_r_H:mod16_r_L,mod16_0:mod16_1
    .LABEL mod16_vm_7
    GTE mod16_1,mod16_r_H:mod16_r_L,mod16_b_H:mod16_b_L
    JZ mod16_vm_9,mod16_1
    SUB mod16_0:mod16_1,mod16_r_H:mod16_r_L,mod16_b_H:mod16_b_L
    MOV mod16_r_H:mod16_r_L,mod16_0:mod16_1
    OR mod16_0:mod16_1,mod16_q_H:mod16_q_L,mod16_flag_H:mod16_flag_L
    MOV mod16_q_H:mod16_q_L,mod16_0:mod16_1
    .LABEL mod16_vm_9
    SHR mod16_0:mod16_1,mod16_flag_H:mod16_flag_L,#$01
    MOV mod16_flag_H:mod16_flag_L,mod16_0:mod16_1
    JMP mod16_vm_4
    .LABEL mod16_vm_5
    JZ mod16_vm_10,mod16_sign
    NEG mod16_0:mod16_1,mod16_r_H:mod16_r_L
    JMP mod16_vm_11
    .LABEL mod16_vm_10
    MOV mod16_0:mod16_1,mod16_r_H:mod16_r_L
    .LABEL mod16_vm_11
    MOV mod16_return_H:mod16_return_L,mod16_0:mod16_1
    JMP mod16_end
    .LABEL mod16_end
.RETURN mod16

.FUNCTION shl8
    .BYTE shl8_return 0
    .BYTE shl8_a 0
    .BYTE shl8_b 0
    .TMP
    .BYTE shl8_0 0
    .CODE
    AND shl8_0,shl8_b,#$07
    MOV shl8_b,shl8_0
    .LABEL shl8_vm_0
    JZ shl8_vm_1,shl8_b
    SHL shl8_0,shl8_a,#$01
    MOV shl8_a,shl8_0
    SUB shl8_0,shl8_b,#$01
    MOV shl8_b,shl8_0
    JMP shl8_vm_0
    .LABEL shl8_vm_1
    MOV shl8_return,shl8_a
    JMP shl8_end
    .LABEL shl8_end
.RETURN shl8

.FUNCTION shl16
    .BYTE shl16_return_H 0
    .BYTE shl16_return_L 0
    .BYTE shl16_a_H 0
    .BYTE shl16_a_L 0
    .BYTE shl16_b 0
    .TMP
    .BYTE shl16_0 0
    .BYTE shl16_1 0
    .CODE
    AND shl16_0,shl16_b,#$0F
    MOV shl16_b,shl16_0
    .LABEL shl16_vm_0
    JZ shl16_vm_1,shl16_b
    SHL shl16_0:shl16_1,shl16_a_H:shl16_a_L,#$01
    MOV shl16_a_H:shl16_a_L,shl16_0:shl16_1
    SUB shl16_1,shl16_b,#$01
    MOV shl16_b,shl16_1
    JMP shl16_vm_0
    .LABEL shl16_vm_1
    MOV shl16_1,shl16_a_H:shl16_a_L
    CAST shl16_return_H:shl16_return_L,shl16_1
    JMP shl16_end
    .LABEL shl16_end
.RETURN shl16

.FUNCTION shr8
    .BYTE shr8_return 0
    .BYTE shr8_a 0
    .BYTE shr8_b 0
    .TMP
    .BYTE shr8_0 0
    .CODE
    AND shr8_0,shr8_b,#$07
    MOV shr8_b,shr8_0
    .LABEL shr8_vm_0
    JZ shr8_vm_1,shr8_b
    SHR shr8_0,shr8_a,#$01
    MOV shr8_a,shr8_0
    SUB shr8_0,shr8_b,#$01
    MOV shr8_b,shr8_0
    JMP shr8_vm_0
    .LABEL shr8_vm_1
    MOV shr8_return,shr8_a
    JMP shr8_end
    .LABEL shr8_end
.RETURN shr8

.FUNCTION shr16
    .BYTE shr16_return_H 0
    .BYTE shr16_return_L 0
    .BYTE shr16_a_H 0
    .BYTE shr16_a_L 0
    .BYTE shr16_b 0
    .TMP
    .BYTE shr16_0 0
    .BYTE shr16_1 0
    .CODE
    AND shr16_0,shr16_b,#$0F
    MOV shr16_b,shr16_0
    .LABEL shr16_vm_0
    JZ shr16_vm_1,shr16_b
    SHR shr16_0:shr16_1,shr16_a_H:shr16_a_L,#$01
    MOV shr16_a_H:shr16_a_L,shr16_0:shr16_1
    SUB shr16_1,shr16_b,#$01
    MOV shr16_b,shr16_1
    JMP shr16_vm_0
    .LABEL shr16_vm_1
    MOV shr16_return_H:shr16_return_L,shr16_a_H:shr16_a_L
    JMP shr16_end
    .LABEL shr16_end
.RETURN shr16
